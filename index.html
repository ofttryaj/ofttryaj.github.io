<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />









  <link rel="alternate" href="/atom.xml" title="big gang silk">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.0.0" />



<link rel="canonical" href="https://ofttryaj.github.io/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0" />



  



    <title> big gang silk </title>
  </head>

  <body>
    <div class="container">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">big gang silk</a>
</div>

<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            首页
          </a>
        </li>
      
        
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            归档
          </a>
        </li>
      
      
    </ul>
  
</nav>

<div class="mobile-navbar">
  <div class="mobile-header">
    <div class="mobile-header-logo">
      <a href="/." class="logo">big gang silk</a>
    </div>

    <div class="mobile-header-icon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
  <nav class="mobile-menu">
    
      
      <a class="mobile-menu-item" href="/">
        首页
      </a>
    
      
      <a class="mobile-menu-item" href="/archives/">
        归档
      </a>
    
  </nav>
</div>
      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  <section id="posts" class="posts">
    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/beego启动流程-context-Context/">beego启动流程-context.Context</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016年12月21日
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h3 id="beego-context-Context-context-BeegoInput-context-BeegoOutput"><a href="#beego-context-Context-context-BeegoInput-context-BeegoOutput" class="headerlink" title="beego context.Context, context.BeegoInput, context.BeegoOutput"></a>beego context.Context, context.BeegoInput, context.BeegoOutput</h3><ul>
<li>context.Context结构体:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">type Context struct &#123;</div><div class="line">	// 处理请求头，数据，cookie，body，它还包含路由参数和当前的session</div><div class="line">	Input          *BeegoInput</div><div class="line">	// 发送响应头</div><div class="line">	Output         *BeegoOutput</div><div class="line">	Request        *http.Request</div><div class="line">	ResponseWriter *Response</div><div class="line">	_xsrfToken     string</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/beego启动流程-context-Context/" class="read-more-link">阅读更多</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/beego启动流程-ControllerRegister如何注册到go内部/">beego启动流程-ControllerRegister如何注册到go内部</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016年12月21日
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h1 id="beego-ControllerRegister"><a href="#beego-ControllerRegister" class="headerlink" title="beego.ControllerRegister"></a>beego.ControllerRegister</h1><blockquote>
<p>这里主要是讲了beego如何将自定义路由处理传递给http.Server.Hanlder字段的，并且理解Go内部是如何调用ControllerRegister.ServeHTTP()方法的。具体深入到ControllerRegister是如何处理路由的，有待进一步学习。</p>
</blockquote>
<p>在beego包中的app.go文件中定义了一个init()函数，这个方法就干了一件事情，就是创建一个App，赋值给一个全局可导出的BeeApp变量，App结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">type App struct &#123;</div><div class="line">	Handlers *ControllerRegister</div><div class="line">	Server   *http.Server</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中http.Server{}有个字段是Handler类型，这个Handler是一个接口里面只有一个函数声明，即：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">type Handler interface &#123;</div><div class="line">	ServeHTTP(ResponseWriter, *Request)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/beego启动流程-ControllerRegister如何注册到go内部/" class="read-more-link">阅读更多</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/Yii2启动流程/">Yii2启动流程</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016年12月21日
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h1 id="Yii2启动流程"><a href="#Yii2启动流程" class="headerlink" title="Yii2启动流程"></a>Yii2启动流程</h1><p>通过上次的Yii2开发环境搭建的目录结构介绍，暴露给外界web目录，该目录下有一个index.php入口文件，那么所有的请求都是从这个入口文件开始的。具体来看看入口文件的代码。</p>
<blockquote>
<p><strong>这里我们只说到Application的实例化过程，具体run这一过程会专门说的。</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">// 我们在对项目进行init的时候，选择的是开发环境，因此debug为ture，env为dev</div><div class="line">defined(&apos;YII_DEBUG&apos;) or define(&apos;YII_DEBUG&apos;, true);</div><div class="line">defined(&apos;YII_ENV&apos;) or define(&apos;YII_ENV&apos;, &apos;dev&apos;);</div><div class="line"></div><div class="line">// 引入composer的自动加载文件</div><div class="line">require(__DIR__ . &apos;/../../vendor/autoload.php&apos;);</div><div class="line">// 引入了Yii2的启动文件，这个文件做了以下几件事情</div><div class="line">// 1. 注册了Yii2自动加载机制，并优先使用Yii2自动加载机制</div><div class="line">// 2. 引入了classes.php文件，限定名称 =&gt; 类的物理路径之间的映射关系</div><div class="line">// 3. Yii::$container，实例化这个依赖注入容器，在一次请求过程中，这个属性是全局唯一的，这个依赖注入容器以后会详细说明</div><div class="line">require(__DIR__ . &apos;/../../vendor/yiisoft/yii2/Yii.php&apos;);</div><div class="line">// 这个文件会向Yii::$aliases追加@common,@frontend,@backend,@console</div><div class="line">// 与之相对应的物理路径，当然我们也可以根据需要添加相应的映射</div><div class="line">require(__DIR__ . &apos;/../../common/config/bootstrap.php&apos;);</div><div class="line">// 与上面的文件功能一致，这个是各自应用独有的，上面是每个应用公用的</div><div class="line">require(__DIR__ . &apos;/../config/bootstrap.php&apos;);</div><div class="line"></div><div class="line">// 整理出yii\web\Application类所需要的格式的配置</div><div class="line">// 从这几个合并的顺序可以看出，应用下的配置会覆盖公共配置</div><div class="line">// -local.php会覆盖.php配置</div><div class="line">$config = yii\helpers\ArrayHelper::merge(</div><div class="line">    require(__DIR__ . &apos;/../../common/config/main.php&apos;),</div><div class="line">    require(__DIR__ . &apos;/../../common/config/main-local.php&apos;),</div><div class="line">    require(__DIR__ . &apos;/../config/main.php&apos;),</div><div class="line">    require(__DIR__ . &apos;/../config/main-local.php&apos;)</div><div class="line">);</div><div class="line"></div><div class="line">// 实例化web application实例</div><div class="line">$application = new yii\web\Application($config);</div><div class="line">// 运行，就是这么优美地运行起来了</div><div class="line">$application-&gt;run();</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/Yii2启动流程/" class="read-more-link">阅读更多</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/Yii2环境搭建/">Yii2开发环境搭建</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016年12月21日
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h1 id="Yii2开发环境搭建"><a href="#Yii2开发环境搭建" class="headerlink" title="Yii2开发环境搭建"></a>Yii2开发环境搭建</h1><p>官方提供的目录架构<a href="https://github.com/yiisoft/yii2-app-advanced">yii2-app-advance</a>|<a href="https://github.com/yiisoft/yii2-app-basic">yii2-app-basice</a>下载release包。</p>
<p>或者可以利用<a href="http://www.phpcomposer.com/">composer</a>管理工具来创建项目，yii2依赖composer-asset-plugin插件，因此必须先安装这个插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">这里采用全局安装，具有全局性。</div><div class="line">composer global require &quot;fxp/composer-asset-plugin:~1.1.1&quot;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">composer create-project yiisoft/yii2-app-basic basic 2.0.9</div><div class="line">or</div><div class="line">composer create-project yiisoft/yii2-app-advanced advanced 2.0.9</div></pre></td></tr></table></figure>
<p>若是下载了官方的包，还需要经过一个步骤,进入到你的项目目录，执行下面的命令，进行安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer install</div></pre></td></tr></table></figure>
<p>这个过程可能会很漫长，国外的资源，建议翻墙。</p>
          <div class="read-more">
            <a href="/2016/12/21/Yii2环境搭建/" class="read-more-link">阅读更多</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/Yii2配置文件/">Yii2配置详解</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016年12月21日
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h1 id="Yii2配置详解"><a href="#Yii2配置详解" class="headerlink" title="Yii2配置详解"></a>Yii2配置详解</h1><p>yii2的配置文件除了公共(common文件夹下的配置)，每个应用目录下都有自己的配置文件，这些配置均包含以下几个文件：(我们这里用的是Yii2官方的高级模板)</p>
<blockquote>
<p><strong>后面还会说到Yii::createObject()方法，因为跟配置有点联系，所以就放在这里</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">main-local.php           ---------- 本地的配置，本地开发需要自己特定的配置，可以覆盖main.php中的配置项</div><div class="line">main.php                 ---------- 正式环境的配置项</div><div class="line">params-local.php         ---------- 本地的参数配置</div><div class="line">params.php               ---------- 正式环境的参数配置</div><div class="line">bootstrap.php            ---------- 设置 aliasName =&gt; 物理路径 映射，比如：@common =&gt; &apos;/Users/llrve/workspaces/php/yii/common&apos;，这里只是为了说明这个文件的作用，物理路径不会这样写死。</div></pre></td></tr></table></figure>
<p>通常*-local.php这类文件都不会加入版本控制，一般都是自己本地开发个性化的配置，比如数据连接配置项，每个人的数据库用户名，密码可能不相同，这里就可以在-local.php文件中配置自己的数据库配置选项。这些文件的优先顺序，可以从入口文件得知：</p>
<ol>
<li>应用的main-local.php会覆盖应用的main.php</li>
<li>应用的main.php会覆盖公共的main-local.php</li>
<li>公共的main-local.php会覆盖公共的main.php</li>
</ol>
          <div class="read-more">
            <a href="/2016/12/21/Yii2配置文件/" class="read-more-link">阅读更多</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/beego启动流程-SESSION/">beego启动流程-SESSION</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016年12月21日
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h3 id="Beego-Session"><a href="#Beego-Session" class="headerlink" title="Beego Session"></a>Beego Session</h3><p>我们知道，beego在跑起来之前，调用了<strong>initBeforeHTTPRun()</strong>这个函数。beego定义了一个全局不可导出的变量<strong>hooks</strong>，这是一个切片，每个元素的类型是func() error，那么前面那个函数就往<strong>hooks</strong>切片中追加元素，追加完成之后，会遍历<strong>hooks</strong>切片，由于切片每一个元素都是函数类型，因此可以直接调用，<strong>hooks</strong>切片中有这些元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">func registerMime() error</div><div class="line">func registerDefaultErrorHandler() error</div><div class="line">func registerSession() error</div><div class="line">func registerTemplate() error</div><div class="line">func registerAdmin() error</div><div class="line">func registerGzip() error</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/beego启动流程-SESSION/" class="read-more-link">阅读更多</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/beego启动流程-配置/">beego启动流程-配置</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016年12月21日
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <p>在beego包下有一个config.go文件，这个文件定义了beego的配置相关的结构体，有以下一些结构体：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">// 这是主配置结构，包含字段和Listen，WebConfig，LogConfig一些结构</div><div class="line">type Config struct &#123;</div><div class="line">	...</div><div class="line">	Listen              Listen</div><div class="line">	WebConfig           WebConfig</div><div class="line">	Log                 LogConfig</div><div class="line">&#125;</div><div class="line">// 与http和https相关的配置</div><div class="line">type Listen struct &#123;</div><div class="line">	...</div><div class="line">&#125;</div><div class="line">// web相关的配置，包含一个SessionConfig结构</div><div class="line">type WebConfig struct &#123;</div><div class="line">	...</div><div class="line">	Session                SessionConfig</div><div class="line">&#125;</div><div class="line">// seesion相关的配置</div><div class="line">type SessionConfig struct &#123;</div><div class="line">	...</div><div class="line">&#125;</div><div class="line">// 日志相关的配置</div><div class="line">type LogConfig struct &#123;</div><div class="line">	...</div><div class="line">&#125;</div><div class="line">// 这个结构体用于解析配置文件，目前beego只用到了ini provider，等下可以从下面的变量知道这一点</div><div class="line">type beegoAppConfig struct &#123;</div><div class="line">	// 这个接口定义了一些方法集，这些方法用于从配置文件中获取和设置值</div><div class="line">	// 比如beego的config包下面实现了这个接口的有xml，yaml，ini，json等</div><div class="line">	innerConfig config.Configer</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来定义了4个可导出的全局变量和两个不可导出的全局变量，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">var (</div><div class="line">	// 应用的主体配置，即我们用bee工具新建的或者手动创建的应用</div><div class="line">	BConfig *Config</div><div class="line">	// beegoAppConfig依赖innerConfig字段来从配置文件中获取和设置值，即实现了config.Conffiger接口的对象</div><div class="line">	// 从下面的newAppConfig()函数中可以了解到，innerConfig就是config.IniConfig&#123;&#125;的实例</div><div class="line">	// 具体如何实现，可以去了解config.IniConfig具体方法的实现</div><div class="line">	AppConfig *beegoAppConfig</div><div class="line">	// 应用的绝对路径</div><div class="line">	AppPath string</div><div class="line">	// session.Manager的实例</div><div class="line">	GlobalSessions *session.Manager</div><div class="line">	// 应用配置文件的路径</div><div class="line">	appConfigPath string</div><div class="line">	// 这个变量是没有办法从外部更改的，除非强行改这里的代码，默认是ini provider</div><div class="line">	appConfigProvider = &quot;ini&quot;</div><div class="line">)</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/beego启动流程-配置/" class="read-more-link">阅读更多</a>
          </div>
        
      
    </div>

    
  </article>

    
  </section>

  
  <nav class="pagination">
    
    
  </nav>


          </div>
          
        </div>  
      </main>

      <footer id="footer" class="footer">
  <div class="social-links">
    
      
        
          <a href="mailto:ofttryaj@163.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
        
          <a href="https://www.facebook.com/ofttryaj" class="iconfont icon-facebook" title="facebook"></a>
        
      
    
      
        
          <a href="https://github.com/ofttryaj" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
    
    
  </div>


<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://hexo.io/">Hexo</a> 强力驱动
  </span>
  
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
    
    2016

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">ofttryaj</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    


    


  <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>

    <script type="text/javascript" src="/js/src/even.js?v=2.0.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.0.0"></script>

  </body>
</html>