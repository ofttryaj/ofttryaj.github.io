<!DOCTYPE html>
<html lang="">
  <head>
    <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />









  <link rel="alternate" href="/atom.xml" title="big gang silk">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.0.0" />



<link rel="canonical" href="https://ofttryaj.github.io/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.0" />



  



    <title> big gang silk </title>
  </head>

  <body>
    <div class="container">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">big gang silk</a>
</div>

<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            Home
          </a>
        </li>
      
        
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            Archives
          </a>
        </li>
      
      
    </ul>
  
</nav>

<div class="mobile-navbar">
  <div class="mobile-header">
    <div class="mobile-header-logo">
      <a href="/." class="logo">big gang silk</a>
    </div>

    <div class="mobile-header-icon">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
  <nav class="mobile-menu">
    
      
      <a class="mobile-menu-item" href="/">
        Home
      </a>
    
      
      <a class="mobile-menu-item" href="/archives/">
        Archives
      </a>
    
  </nav>
</div>
      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  <section id="posts" class="posts">
    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/beego启动流程-context-Context/">beego启动流程-context.Context</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Dec 21, 2016
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        

        
          <h3 id="beego-context-Context-context-BeegoInput-context-BeegoOutput"><a href="#beego-context-Context-context-BeegoInput-context-BeegoOutput" class="headerlink" title="beego context.Context, context.BeegoInput, context.BeegoOutput"></a>beego context.Context, context.BeegoInput, context.BeegoOutput</h3><ul>
<li>context.Context结构体:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">type Context struct &#123;</div><div class="line">	// 处理请求头，数据，cookie，body，它还包含路由参数和当前的session</div><div class="line">	Input          *BeegoInput</div><div class="line">	// 发送响应头</div><div class="line">	Output         *BeegoOutput</div><div class="line">	Request        *http.Request</div><div class="line">	ResponseWriter *Response</div><div class="line">	_xsrfToken     string</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p>Request，ResponseWriter字段都是由go内部根据请求创建的request，response对象传过来的，这两个对象提供了一系列跟HTTP请求相关的方法，比如判断请求方式（GET，POST），获取请求头，cookie相关的操作等等，这些方法会体现在BeegoInput，BeegoOupt方法集中；<br>Request字段是go内核中的http.Request类型，但是ResponseWriter字段，则依赖context.Response中匿名字段http.ResponseWriter的具体实现，我通过看go内核源码，可以知道，http.Resposne实现了http.ResponseWirter，并且我们也知道go内部也是创建了http.Response并且通过beego.ControllerRegister.ServeHTTP(w, req)传入的，可以看考我之前写的文章<a href="http://aj.gitgang.com/?p=106" target="_blank" rel="external">beego.ControllerRegister如何注册到go内部的</a>，对request，response的大部分操作，本质上还是go内核中的http.Request，http.Response对象提供的相关方法；</p>
</li>
<li><p>Input和Output的类型从上面的结构体可以得知，上面说了很多关于request，response相关的东西，是为了更好的理解Input和Output相关方法集，比如BeegoInput.Header(key string)方法中，就调用了input.Context.Request.Header.Get(key)等等很多这样的方法，都依赖http.Request方法集；BeegoOutput.Header(key, val string)，也调用了output.Context.ResponseWriter.Header().Set(key, val)这个方法，具体可以自己通过源码深入了解；</p>
</li>
<li><p>上面的Request,ResponseWriter是如何注入的，下面会说到。我们来了解下Context.Reset(rw http.ResponseWriter, r *http.Request), BeegoInput.Reset(ctx *Context), beegoOutput.Reset(ctx *Context)，这些方法从字面意思来看，是做重置操作的，其实也确实是在做这样的操作，在ServeHTTP(w, req)方法中我们会看到，调用context.Reset(w, req)方法</p>
<ul>
<li><p>Context.Reset()，req参数会赋给Request字段，ResponseWriter字段则要复杂点，若ResponseWriter为空，则取&amp;Response{}（这个response是beego的context.Response类型）赋值，之后调用conext.Response.reset(rw http.ResponseWriter)方法，进行重置操作，会把w赋值给Response的ResponseWriter匿名字段，后面两个字段Status = 0，Started = false。接下来调用BeegoInput.Reset()和BeegoOutput.Reset()，_xsrfToken = “”；</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">func (ctx *Context) Reset(rw http.ResponseWriter, r *http.Request) &#123;</div><div class="line">	ctx.Request = r</div><div class="line">	if ctx.ResponseWriter == nil &#123;</div><div class="line">		ctx.ResponseWriter = &amp;Response&#123;&#125;</div><div class="line">	&#125;</div><div class="line">	ctx.ResponseWriter.reset(rw)</div><div class="line">	ctx.Input.Reset(ctx)</div><div class="line">	ctx.Output.Reset(ctx)</div><div class="line">	ctx._xsrfToken = &quot;&quot;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>context.Response同时实现了http.Flusher,http.Hijacker,http.CloseNotifier三个接口。同时还重写了http.Response的Write(),WriteHeader()方法</p>
</blockquote>
</li>
<li><p>BeegoInput.Reset()会把ctx（即当前上下文对象）赋值给Context字段，剩下的就是重置字段；</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">func (input *BeegoInput) Reset(ctx *Context) &#123;</div><div class="line">	input.Context = ctx</div><div class="line">	input.CruSession = nil</div><div class="line">	input.pnames = input.pnames[:0]</div><div class="line">	input.pvalues = input.pvalues[:0]</div><div class="line">	input.data = nil</div><div class="line">	input.RequestBody = []byte&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>BeegoOutput.Reset()第一步也是赋值Context字段，Status = 0；</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">func (output *BeegoOutput) Reset(ctx *Context) &#123;</div><div class="line">	output.Context = ctx</div><div class="line">	output.Status = 0</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>为什么要说这么多，其实后面我们会知道beego.ControllerRegister.ServeHTTP()方法中，当请求过来的时候，go内部会把封装好了的http.Request和http.Response对象传递给这个ServeHTTP()方法中，接下来会从对象池pool中获取一个context对象，会对着这个对象进行重置操作，即context.Reset(rw, r)，我们了解Reset操作后才能更好的理解处理请求后续的操作。</p>
</blockquote>
<ul>
<li><p>我们来看看Context,BeegoInput,BeegoOuput对象提供的一些方法</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">func (ctx *Context) GetCookie(key string) string &#123;</div><div class="line">	return ctx.Input.Cookie(key)</div><div class="line">&#125;</div><div class="line"></div><div class="line">func (ctx *Context) SetCookie(name string, value string, others ...interface&#123;&#125;) &#123;</div><div class="line">	ctx.Output.Cookie(name, value, others...)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>以上两个方法，大家都知道是获取cookie，设置cookie信息的功能，我们知道设置cookie信息是服务器告诉浏览器，你帮我把这些信息保存在你这，等下次浏览器请求服务器的时候，浏览器会把这些信息放在请求体中发送给服务器。我们上面也知道了BeegoInput和BeegoOutput相关含义，因此，SetCookie会调用BeegoOuput.Cookie()方法，而GetCookie()则是调用BeegoInput()方法，那么我们就来看下具体实现。</p>
</blockquote>
</li>
<li><p>BeegoOuput.Cookie()</p>
<ul>
<li>这个方法的签名：func (output *BeegoOutput) Cookie(name string, value string, others …interface{})</li>
<li><p>先来解释下这个方法需要的参数，<strong>name string, value string, others …interface{}</strong>，前两个参数一看就知道是cookie名称和值了，这个others则是<strong>max age time, path,domain, secure and httponly</strong>，并且是严格按照这个顺序来的；当我这样尝试着调用Cookie()方法时，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Cookie(&quot;cookieName&quot;, &quot;CookeValue&quot;, 145, &quot;/&quot;, &quot;http://aj.gitgang.com&quot;, true, true)</div><div class="line">// 往Set-Cookie头信息写入的内容是</div><div class="line">// cookieName=CookeValue; Expires=Fri, 16 Dec 2016 08:29:19 UTC; Max-Age=145; Path=/; Domain=http://aj.gitgang.com; Secure; HttpOnly</div></pre></td></tr></table></figure>
</li>
<li><p>beego在output.go文件中封装了两个替换器<strong>strings.NewReplacer(“\n”, “-“, “\r”, “-“)</strong>和<strong>strings.NewReplacer(“\n”, “ “, “\r”, “ “, “;”, “ “)</strong>，第一个替换器就是把\n，\r转换为-，第二个则是把\n，\r，;替换为空格</p>
</li>
<li><p>方法首先声明了一个var b bytes.Buffer，所有的内容都放在这个变量里；</p>
</li>
<li><p>先对name和value分别用上面两个替换器进行替换，接下来会按照这样的格式<strong>“%s=%s”</strong>写入变量b中；</p>
</li>
<li><p>接下来会判断others变量中的参数个数进行判断，上面我们说到了others这个参数，这个参数是不定长的，但是我们传入参数的含义，是按顺序定义好了的，按顺序解释如下：</p>
<ol>
<li>max age time：cookie过期时间，这里可能不恰当，但是beego确实利用这个值对cookie设置了过期时间，beego解释说为了解决cookie在IE下的问题；</li>
<li>path：cookie路径，那些cookie在服务器上的该路径下能够被访问，如果设置”/“，那么这个cookie能在整个网站根目录下被访问，若设置/foo/，那么只能是/foo/及其子目录下能够访问该cookie；</li>
<li>domain：cookie域，指定cookie发送至哪些域</li>
<li>secure：用来表示cookie是不是仅仅只能通过安全的HTTPS连接进行传输；</li>
<li>httponly：当设置为true，cookie只能通过http协议访问，不能被脚本语言访问，例如javascript</li>
</ol>
<p>如果传入了一个参数并且符合条件，则往变量b中写入类似这样的<strong>; Expires=Fri, 16 Dec 2016 08:29:19 UTC; Max-Age=145</strong>内容，否则写入<strong>; Max-Age=0</strong></p>
<p>如果传入了第二个参数并符合条件，则写入<strong>; Path=/foo/</strong>，否则<strong>; Path=/</strong></p>
<p>如果传入第三个参数并符合条件，则写入<strong>; Domain=<a href="http://aj.gitgang.com" target="_blank" rel="external">http://aj.gitgang.com</a></strong>，否则忽略</p>
<p>如果传入第四个参数并符合条件，则写入<strong>; Secure</strong>，否则忽略</p>
<p>如果传入第五个参数并符合条件，则写入<strong>; ; HttpOnly</strong>，否则忽略</p>
<p>如果参数全部传入的话，则会构造这样的一个字符串<strong>cookieName=CookeValue; Expires=Fri, 16 Dec 2016 08:29:19 UTC; Max-Age=145; Path=/; Domain=<a href="http://aj.gitgang.com" target="_blank" rel="external">http://aj.gitgang.com</a>; Secure; HttpOnly</strong></p>
</li>
<li><p>最后调用output.Context.ResponseWriter.Header().Add(“Set-Cookie”, b.String())，放到响应头；</p>
</li>
</ul>
</li>
<li><p>BeegoInput.Cookie()</p>
<ul>
<li>这个方法的签名：func (input *BeegoInput) Cookie(key string) string </li>
<li>方法直接调用input.Context.Request.Cookie(key)来从请求体中获取cookie的值，若出错则返回空字符串；</li>
</ul>
</li>
</ul>
<blockquote>
<p>这里只是列举了操作cookie的方法，还有像获取头部信息，请求参数，Session，响应的数据格式json，xml等等很多方法，就不一一列举了，大家可以自己去了解相关的东西</p>
</blockquote>

        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/beego启动流程-ControllerRegister如何注册到go内部/">beego启动流程-ControllerRegister如何注册到go内部</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Dec 21, 2016
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h1 id="beego-ControllerRegister"><a href="#beego-ControllerRegister" class="headerlink" title="beego.ControllerRegister"></a>beego.ControllerRegister</h1><blockquote>
<p>这里主要是讲了beego如何将自定义路由处理传递给http.Server.Hanlder字段的，并且理解Go内部是如何调用ControllerRegister.ServeHTTP()方法的。具体深入到ControllerRegister是如何处理路由的，有待进一步学习。</p>
</blockquote>
<p>在beego包中的app.go文件中定义了一个init()函数，这个方法就干了一件事情，就是创建一个App，赋值给一个全局可导出的BeeApp变量，App结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">type App struct &#123;</div><div class="line">	Handlers *ControllerRegister</div><div class="line">	Server   *http.Server</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其中http.Server{}有个字段是Handler类型，这个Handler是一个接口里面只有一个函数声明，即：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">type Handler interface &#123;</div><div class="line">	ServeHTTP(ResponseWriter, *Request)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/beego启动流程-ControllerRegister如何注册到go内部/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/Yii2启动流程/">Yii2启动流程</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Dec 21, 2016
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h1 id="Yii2启动流程"><a href="#Yii2启动流程" class="headerlink" title="Yii2启动流程"></a>Yii2启动流程</h1><p>通过上次的Yii2开发环境搭建的目录结构介绍，暴露给外界web目录，该目录下有一个index.php入口文件，那么所有的请求都是从这个入口文件开始的。具体来看看入口文件的代码。</p>
<blockquote>
<p><strong>这里我们只说到Application的实例化过程，具体run这一过程会专门说的。</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">// 我们在对项目进行init的时候，选择的是开发环境，因此debug为ture，env为dev</div><div class="line">defined(&apos;YII_DEBUG&apos;) or define(&apos;YII_DEBUG&apos;, true);</div><div class="line">defined(&apos;YII_ENV&apos;) or define(&apos;YII_ENV&apos;, &apos;dev&apos;);</div><div class="line"></div><div class="line">// 引入composer的自动加载文件</div><div class="line">require(__DIR__ . &apos;/../../vendor/autoload.php&apos;);</div><div class="line">// 引入了Yii2的启动文件，这个文件做了以下几件事情</div><div class="line">// 1. 注册了Yii2自动加载机制，并优先使用Yii2自动加载机制</div><div class="line">// 2. 引入了classes.php文件，限定名称 =&gt; 类的物理路径之间的映射关系</div><div class="line">// 3. Yii::$container，实例化这个依赖注入容器，在一次请求过程中，这个属性是全局唯一的，这个依赖注入容器以后会详细说明</div><div class="line">require(__DIR__ . &apos;/../../vendor/yiisoft/yii2/Yii.php&apos;);</div><div class="line">// 这个文件会向Yii::$aliases追加@common,@frontend,@backend,@console</div><div class="line">// 与之相对应的物理路径，当然我们也可以根据需要添加相应的映射</div><div class="line">require(__DIR__ . &apos;/../../common/config/bootstrap.php&apos;);</div><div class="line">// 与上面的文件功能一致，这个是各自应用独有的，上面是每个应用公用的</div><div class="line">require(__DIR__ . &apos;/../config/bootstrap.php&apos;);</div><div class="line"></div><div class="line">// 整理出yii\web\Application类所需要的格式的配置</div><div class="line">// 从这几个合并的顺序可以看出，应用下的配置会覆盖公共配置</div><div class="line">// -local.php会覆盖.php配置</div><div class="line">$config = yii\helpers\ArrayHelper::merge(</div><div class="line">    require(__DIR__ . &apos;/../../common/config/main.php&apos;),</div><div class="line">    require(__DIR__ . &apos;/../../common/config/main-local.php&apos;),</div><div class="line">    require(__DIR__ . &apos;/../config/main.php&apos;),</div><div class="line">    require(__DIR__ . &apos;/../config/main-local.php&apos;)</div><div class="line">);</div><div class="line"></div><div class="line">// 实例化web application实例</div><div class="line">$application = new yii\web\Application($config);</div><div class="line">// 运行，就是这么优美地运行起来了</div><div class="line">$application-&gt;run();</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/Yii2启动流程/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/Yii2环境搭建/">Yii2开发环境搭建</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Dec 21, 2016
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h1 id="Yii2开发环境搭建"><a href="#Yii2开发环境搭建" class="headerlink" title="Yii2开发环境搭建"></a>Yii2开发环境搭建</h1><p>官方提供的目录架构<a href="https://github.com/yiisoft/yii2-app-advanced">yii2-app-advance</a>|<a href="https://github.com/yiisoft/yii2-app-basic">yii2-app-basice</a>下载release包。</p>
<p>或者可以利用<a href="http://www.phpcomposer.com/">composer</a>管理工具来创建项目，yii2依赖composer-asset-plugin插件，因此必须先安装这个插件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">这里采用全局安装，具有全局性。</div><div class="line">composer global require &quot;fxp/composer-asset-plugin:~1.1.1&quot;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">composer create-project yiisoft/yii2-app-basic basic 2.0.9</div><div class="line">or</div><div class="line">composer create-project yiisoft/yii2-app-advanced advanced 2.0.9</div></pre></td></tr></table></figure>
<p>若是下载了官方的包，还需要经过一个步骤,进入到你的项目目录，执行下面的命令，进行安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">composer install</div></pre></td></tr></table></figure>
<p>这个过程可能会很漫长，国外的资源，建议翻墙。</p>
          <div class="read-more">
            <a href="/2016/12/21/Yii2环境搭建/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/Yii2配置文件/">Yii2配置详解</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Dec 21, 2016
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h1 id="Yii2配置详解"><a href="#Yii2配置详解" class="headerlink" title="Yii2配置详解"></a>Yii2配置详解</h1><p>yii2的配置文件除了公共(common文件夹下的配置)，每个应用目录下都有自己的配置文件，这些配置均包含以下几个文件：(我们这里用的是Yii2官方的高级模板)</p>
<blockquote>
<p><strong>后面还会说到Yii::createObject()方法，因为跟配置有点联系，所以就放在这里</strong></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">main-local.php           ---------- 本地的配置，本地开发需要自己特定的配置，可以覆盖main.php中的配置项</div><div class="line">main.php                 ---------- 正式环境的配置项</div><div class="line">params-local.php         ---------- 本地的参数配置</div><div class="line">params.php               ---------- 正式环境的参数配置</div><div class="line">bootstrap.php            ---------- 设置 aliasName =&gt; 物理路径 映射，比如：@common =&gt; &apos;/Users/llrve/workspaces/php/yii/common&apos;，这里只是为了说明这个文件的作用，物理路径不会这样写死。</div></pre></td></tr></table></figure>
<p>通常*-local.php这类文件都不会加入版本控制，一般都是自己本地开发个性化的配置，比如数据连接配置项，每个人的数据库用户名，密码可能不相同，这里就可以在-local.php文件中配置自己的数据库配置选项。这些文件的优先顺序，可以从入口文件得知：</p>
<ol>
<li>应用的main-local.php会覆盖应用的main.php</li>
<li>应用的main.php会覆盖公共的main-local.php</li>
<li>公共的main-local.php会覆盖公共的main.php</li>
</ol>
          <div class="read-more">
            <a href="/2016/12/21/Yii2配置文件/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/beego启动流程-SESSION/">beego启动流程-SESSION</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Dec 21, 2016
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <h3 id="Beego-Session"><a href="#Beego-Session" class="headerlink" title="Beego Session"></a>Beego Session</h3><p>我们知道，beego在跑起来之前，调用了<strong>initBeforeHTTPRun()</strong>这个函数。beego定义了一个全局不可导出的变量<strong>hooks</strong>，这是一个切片，每个元素的类型是func() error，那么前面那个函数就往<strong>hooks</strong>切片中追加元素，追加完成之后，会遍历<strong>hooks</strong>切片，由于切片每一个元素都是函数类型，因此可以直接调用，<strong>hooks</strong>切片中有这些元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">func registerMime() error</div><div class="line">func registerDefaultErrorHandler() error</div><div class="line">func registerSession() error</div><div class="line">func registerTemplate() error</div><div class="line">func registerAdmin() error</div><div class="line">func registerGzip() error</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/beego启动流程-SESSION/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    
  </article>

    
      
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          <a class="post-link" href="/2016/12/21/beego启动流程-配置/">beego启动流程-配置</a>
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          Dec 21, 2016
        </span>
      </div>
    </header>

    

    <div class="post-content">
      
        
          
        

        
          <p>在beego包下有一个config.go文件，这个文件定义了beego的配置相关的结构体，有以下一些结构体：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">// 这是主配置结构，包含字段和Listen，WebConfig，LogConfig一些结构</div><div class="line">type Config struct &#123;</div><div class="line">	...</div><div class="line">	Listen              Listen</div><div class="line">	WebConfig           WebConfig</div><div class="line">	Log                 LogConfig</div><div class="line">&#125;</div><div class="line">// 与http和https相关的配置</div><div class="line">type Listen struct &#123;</div><div class="line">	...</div><div class="line">&#125;</div><div class="line">// web相关的配置，包含一个SessionConfig结构</div><div class="line">type WebConfig struct &#123;</div><div class="line">	...</div><div class="line">	Session                SessionConfig</div><div class="line">&#125;</div><div class="line">// seesion相关的配置</div><div class="line">type SessionConfig struct &#123;</div><div class="line">	...</div><div class="line">&#125;</div><div class="line">// 日志相关的配置</div><div class="line">type LogConfig struct &#123;</div><div class="line">	...</div><div class="line">&#125;</div><div class="line">// 这个结构体用于解析配置文件，目前beego只用到了ini provider，等下可以从下面的变量知道这一点</div><div class="line">type beegoAppConfig struct &#123;</div><div class="line">	// 这个接口定义了一些方法集，这些方法用于从配置文件中获取和设置值</div><div class="line">	// 比如beego的config包下面实现了这个接口的有xml，yaml，ini，json等</div><div class="line">	innerConfig config.Configer</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>接下来定义了4个可导出的全局变量和两个不可导出的全局变量，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">var (</div><div class="line">	// 应用的主体配置，即我们用bee工具新建的或者手动创建的应用</div><div class="line">	BConfig *Config</div><div class="line">	// beegoAppConfig依赖innerConfig字段来从配置文件中获取和设置值，即实现了config.Conffiger接口的对象</div><div class="line">	// 从下面的newAppConfig()函数中可以了解到，innerConfig就是config.IniConfig&#123;&#125;的实例</div><div class="line">	// 具体如何实现，可以去了解config.IniConfig具体方法的实现</div><div class="line">	AppConfig *beegoAppConfig</div><div class="line">	// 应用的绝对路径</div><div class="line">	AppPath string</div><div class="line">	// session.Manager的实例</div><div class="line">	GlobalSessions *session.Manager</div><div class="line">	// 应用配置文件的路径</div><div class="line">	appConfigPath string</div><div class="line">	// 这个变量是没有办法从外部更改的，除非强行改这里的代码，默认是ini provider</div><div class="line">	appConfigProvider = &quot;ini&quot;</div><div class="line">)</div></pre></td></tr></table></figure>
          <div class="read-more">
            <a href="/2016/12/21/beego启动流程-配置/" class="read-more-link">Read more..</a>
          </div>
        
      
    </div>

    
  </article>

    
  </section>

  
  <nav class="pagination">
    
    
  </nav>


          </div>
          
        </div>  
      </main>

      <footer id="footer" class="footer">
  <div class="social-links">
    
      
        
          <a href="mailto:ofttryaj@163.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
        
          <a href="https://www.facebook.com/ofttryaj" class="iconfont icon-facebook" title="facebook"></a>
        
      
    
      
        
          <a href="https://github.com/ofttryaj" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
    
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
    
    2016

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">ofttryaj</span>
  </span>
</div>
      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    


    


  <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>

    <script type="text/javascript" src="/js/src/even.js?v=2.0.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.0.0"></script>

  </body>
</html>